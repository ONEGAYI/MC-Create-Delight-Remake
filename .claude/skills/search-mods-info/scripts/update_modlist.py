#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
更新模组列表脚本
用于为指定的模组编号填写缺失的信息
"""

import re
import sys
import os

def update_mod_info(file_path, mod_updates):
    """
    更新指定模组的信息

    Args:
        file_path: 文件路径
        mod_updates: 需要更新的模组信息字典 {编号: (环境, 标签, 描述)}
    """
    try:
        # 读取文件内容
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        # 逐行处理
        lines = content.split('\n')
        updated_lines = []

        for line in lines:
            # 匹配表格行
            match = re.match(r'^(\d+)\|([^|]+)\|([^|]*)\|([^|]*)\|([^|]*)$', line)
            if match:
                num = int(match.group(1))
                name = match.group(2).strip()

                # 如果这个编号需要更新
                if num in mod_updates:
                    env, tags, desc = mod_updates[num]
                    # 保持原名称，只更新后面的信息
                    updated_line = f"{num}|{name}| {env} | {tags} | {desc}"
                    updated_lines.append(updated_line)
                    print(f"更新 {num}号模组: {name}")
                else:
                    updated_lines.append(line)
            else:
                updated_lines.append(line)

        # 写回文件
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write('\n'.join(updated_lines))

        print(f"成功更新 {len(mod_updates)} 个模组的信息")

    except Exception as e:
        print(f"更新文件时出错: {e}")
        return False

    return True

def main():
    # 文件路径 - 使用绝对路径
    base_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(__file__)))))
    file_path = os.path.join(base_dir, 'docs', 'mods-list.md')

    # 需要更新的模组信息
    mod_updates = {
        261: ("双端类", "#装备与战斗", "机械动力附加模组，提供蒸汽朋克风格装甲"),
        262: ("双端类", "#库与依赖", "Fuzs模组的核心库，提供模组加载器抽象层"),
        263: ("双端类", "#食物与农业", "为食物添加品质系统，提升营养和饱和度"),
        264: ("双端类", "#辅助工具", "模块化模组，添加大量小型原版风格功能"),
        265: ("双端类", "#装饰与建筑", "Quark的附属模组，添加背包、管道等特殊功能"),
        266: ("双端类", "#辅助工具", "FTB任务系统的扩展，添加新任务类型和奖励"),
        267: ("双端类", "#界面增强", "Curios/Trinkets API与动态光源模组的兼容桥"),
        268: ("双端类", "#性能优化", "Lithium模组的Forge非官方分支，优化游戏性能"),
        269: ("双端类", "#装饰与建筑", "MrCrayfish家具模组的重制版，添加新家具"),
        270: ("客户端", "#库与依赖", "KubeJS的渲染支持库，用于绘制HUD和物品渲染"),
        # 271-285号模组更新
        271: ("双端类", "#库与依赖", "制作跨平台配置文件的模组库"),
        272: ("双端类", "#库与依赖", "为其他模组提供底层支持和通用功能库"),
        273: ("客户端", "#界面增强", "游戏内资源包、数据包和着色器浏览器及更新器"),
        274: ("双端类", "#库与依赖", "JavaScript脚本引擎支持库（KubeJS相关）"),
        275: ("双端类", "#库与依赖", "弹射物功能扩展库"),
        276: ("双端类", "#库与依赖", "Rune系列模组核心库"),
        277: ("客户端", "#界面增强", "游戏内截图查看器"),
        278: ("客户端", "#界面增强", "容器物品搜索功能"),
        279: ("服务端类", "#世界扩展", "添加四季变化系统，影响植被和天气"),
        280: ("客户端", "#界面增强", "显示当前季节和剩余时间的小UI"),
        281: ("服务端类", "#性能优化", "优化服务端性能，减少卡顿和延迟"),
        282: ("双端类", "#库与依赖", "提供API支持，作为其他模组的依赖库"),
        283: ("客户端", "#界面增强", "改进第三人称视角，提供更多视角选项"),
        284: ("双端类", "#食物与农业", "扩展农夫乐事，添加新食物和厨具"),
        285: ("服务端类", "#辅助工具", "自动备份服务器世界，提供备份管理"),
        # 286-300号模组更新
        286: ("客户端", "#界面增强", "将玩家的皮肤第二层渲染为3D效果"),
        287: ("客户端", "#辅助工具", "阻止模组网络连接，防止加载缓慢或崩溃"),
        288: ("客户端", "#性能优化", "Sodium的附加功能模组，添加更多渲染选项"),
        289: ("双端类", "#食物与农业", "奖励玩家制作大型多样化餐食"),
        290: ("双端类", "#食物与农业", "通过食用不同食物永久增加最大生命值"),
        291: ("双端类", "#食物与农业", "让玩家可以设计和制作自己的三明治"),
        292: ("双端类", "#辅助工具", "可放置、升级和定制的高级背包模组"),
        293: ("双端类", "#整合与联动[Sophisticated Backpacks & Create]", "让高级背包能在Create机械装置中使用"),
        294: ("双端类", "#库与依赖", "Sophisticated系列模组的核心库"),
        295: ("双端类", "#魔法与特殊", "增强灵魂火的功能，添加新的火焰效果"),
        296: ("双端类", "#性能优化", "Minecraft性能分析工具，用于客户端和服务端"),
        297: ("双端类", "#库与依赖", "SuperMartijn642的配置文件库"),
        298: ("双端类", "#库与依赖", "SuperMartijn642的核心库，提供基础实现"),
        299: ("双端类", "#装饰与建筑", "添加罐子、指示牌、水龙头等装饰和自动化物品"),
        300: ("双端类", "#装备与战斗", "添加各种现代枪械的武器模组"),
        # 301-310号模组更新
        301: ("双端类", "#装备与战斗", "TACZ枪械模组的扩展插件，提供额外的枪械配件和改造支持"),
        302: ("服务端", "#世界扩展", "革命性的世界生成模组，创造大陆级地形、巨大山脉、地下河流和深邃海洋"),
        303: ("双端类", "#库与依赖", "为开发者提供的库模组，包含实体动画系统、武器AOE攻击工具和实用方法"),
        304: ("服务端", "#世界扩展", "添加95+新生物群系，更新所有原版生物群系，包含峡谷、浮岛、深海沟等地形"),
        305: ("双端类", "#装备与战斗", "模块化工具武器系统，通过工作台创建可定制的装备，结合探索与科技元素"),
        306: ("双端类", "#库与依赖", "Tetra官方兼容性模组，支持将其他模组物品转换为Tetra物品，并添加新材料支持"),
        307: ("双端类", "#库与依赖", "增强Tetra与其他模组的兼容性，支持多种第三方模组的Tetra集成"),
        308: ("双端类", "#装备与战斗", "Tetra与Better Combat的兼容模组，为模块化武器提供增强的战斗系统支持"),
        309: ("双端类", "#世界扩展", "蜜蜂维度模组，通过投掷末影珍珠到蜂巢进入，充满蜜蜂相关方块、结构和独特装备"),
        310: ("客户端", "#界面增强", "在游戏加载界面显示实用提示，支持模组包和模组添加自定义提示内容"),
        # 311-325号模组更新
        311: ("双端类", "#库与依赖", "HRZN工作室的库模组，为horizon模组提供共享代码"),
        312: ("双端类", "#辅助工具", "控制怪物生成的特殊火把，添加巨型火把阻止敌对生物生成"),
        313: ("双端类", "#世界扩展", "受塞尔达传说启发的塔楼结构，在多维度生成高塔"),
        314: ("服务端", "#世界扩展", "新增50多种村庄结构，兼容各地形生成模组"),
        315: ("服务端", "#辅助工具", "刷新村民交易内容，帮助快速获得更好交易组合"),
        316: ("双端类", "#食物与农业", "为农夫乐事添加1.20更新相关的新食物"),
        317: ("双端类", "#辅助工具", "多种功能的垃圾桶方块，处理多余物品、液体和能量"),
        318: ("客户端", "#界面增强", "在物品栏界面添加垃圾槽，方便删除不需要的物品"),
        319: ("客户端", "#界面增强", "进入生物群系和维度时显示RPG风格标题"),
        320: ("双端类", "#库与依赖", "花之密语模组的库模组，提供共享代码支持"),
        321: ("双端类", "#辅助工具", "为复古改进添加KubeJS脚本支持，允许自定义配方"),
        322: ("双端类", "#食物与农业", "农民乐事扩展，添加腌制和奶酪制作机制"),
        323: ("双端类", "#工业自动化", "Create模组扩展，添加新机器、材料和化学元素"),
        324: ("客户端", "#界面增强", "可视化按键绑定工具，帮助直观管理和配置快捷键"),
        325: ("双端类", "#整合与联动", "Valkyrien Skies 2扩展，添加Create兼容和后坐力支持"),
        # 326-340号模组更新
        326: ("双端类", "#辅助工具", "显示玩家状态的视觉化工具"),
        327: ("双端类", "#交通与运输", "快速传送系统"),
        328: ("客户端", "#辅助工具", "世界种子预览工具"),
        329: ("客户端", "#界面增强", "界面小地图显示"),
        330: ("双端类", "#整合与联动", "传送石与小地图联动"),
        331: ("客户端", "#界面增强", "全屏世界地图显示"),
        332: ("客户端", "#辅助工具", "禁用实验性警告弹窗"),
        333: ("双端类", "#库与依赖", "模组配置界面库"),
        334: ("双端类", "#食物与农业, #世界扩展", "日式食物与东方内容"),
        335: ("双端类", "#库与依赖", "YUNG模组核心库"),
        336: ("服务端", "#世界扩展", "末地岛屿改选"),
        337: ("服务端", "#世界扩展", "废弃矿洞改进"),
        338: ("服务端", "#世界扩展", "女巫小屋改进"),
        339: ("服务端", "#世界扩展", "额外小型结构"),
        340: ("双端类", "#库与依赖", "模块化模组框架库"),
    }

    print("准备更新以下模组信息：")
    for num, (env, tags, desc) in mod_updates.items():
        print(f"  {num}号: {env} | {tags} | {desc}")

    print("\n开始更新...")
    success = update_mod_info(file_path, mod_updates)

    if success:
        print("\n更新完成！")
    else:
        print("\n更新失败！")
        sys.exit(1)

if __name__ == "__main__":
    main()